<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_picking_for_shiprocket" model="ir.ui.view">
        <field name="name">stock.picking.form.inherit.delivery.shiprocket</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="delivery.view_picking_withcarrier_out_form" />
        <field name="arch" type="xml">
            <xpath expr="//page[@name='note']" position="before">
                <page string="Shiprocket Details" attrs="{'invisible':[('delivery_type','!=','shiprocket')]}">
                    <group>
                        <group>
                            <field name="pickup_location" attrs="{'readonly': [('state', 'in', ('done', 'cancel')),('shiprocket_order_id', '!=', False)]}" options="{'no_create': True, 'no_open': True}" />
                            <field name="channel_id" attrs="{'readonly': [('state', 'in', ('done', 'cancel')),('shiprocket_order_id', '!=', False)]}" options="{'no_create': True, 'no_open': True}" />
                            <field name="shipping_charges" attrs="{'readonly': [('state', 'in', ('done', 'cancel')),('shiprocket_order_id', '!=', False)]}" />
                            <field name="giftwrap_charges" attrs="{'readonly': [('state', 'in', ('done', 'cancel')),('shiprocket_order_id', '!=', False)]}" />
                            <field name="transaction_charges" attrs="{'readonly': [('state', 'in', ('done', 'cancel')),('state', 'in', ('done', 'cancel'))]}" />
                            <field name="order_type" attrs="{'readonly': [('state', 'in', ('done', 'cancel')),('state', 'in', ('done', 'cancel'))]}" />
                            <field name="payment_method" attrs="{'readonly': [('state', 'in', ('done', 'cancel')),('state', 'in', ('done', 'cancel'))]}" />
                        </group>
                        <group>
                            <field name="shiprocket_order_id" readonly="1" />
                            <field name="shiprocket_order_status_id" readonly="1" />
                            <field name="shiprocket_shipping_id" readonly="1" />
                            <field name="courier_id" readonly="1" />
                            <field name="courier_rate" readonly="1" />
                            <field name="is_order_rto"/>
                            <field name="rto_courier_rate" attrs="{'invisible':[('is_order_rto','=',False)]}"/>
                            <field name="shiprocket_awb_code" readonly="1" />
                            <field name="manifest_url" widget="url" readonly="1" />
                            <field name="label_url" widget="url" readonly="1" />
                            <field name="is_manifest_generated" invisible="1" />
                            <field name="is_pickup_request_done" invisible="1" />
                            <field name="is_ndr" invisible="1" />
                            <field name="bulk_order_id" readonly="1" attrs="{'invisible':[('bulk_order_id','=',False)]}" />
                        </group>
                        <field name="response_comment" readonly="1"/>
                        <field name="comment" placeholder="Reseller: M/s Goku" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}" />
                        <field name="pickup_request_note" placeholder="Pickup Request Note" readonly="1" />
                        <field name="cancel_reason" readonly="1"/>
                    </group>
                </page>
                <page string="Shiprocket Cost Matrix" attrs="{'invisible':['|',('delivery_type','!=','shiprocket'),('shiprocket_serviceability_matrix','=',False)]}">
                    <separator />
                    <field name="shiprocket_serviceability_matrix">
                        <tree>
                            <field name="courier_name" invisible="1" />
                            <field name="courier_company_id" decoration-bf="1"/>
                            <field name="rate" decoration-bf="1"/>
                            <field name="rating" />
                            <field name="etd" />
                            <field name="etd_hours" />
                            <field name="estimated_delivery_days" />
                        </tree>
                    </field>
                    <group string="Recommended Courier">
                        <group>
                            <field name="recommended_courier_company_id" readonly="1" />
                            <field name="shiprocket_recommended_courier_id" readonly="1" />
                            <button class="btn btn-info btn-lg btn-block" icon="fa-edit" type="object" name="set_courier_id" string="Set Courier" />
                        </group>
                    </group>
                </page>
                <page name="ndr_history" string="NDR Details" attrs="{'invisible':[('is_ndr','=',False)]}">
                    <field name="ndr_history_line">
                        <tree> 
                            <field name="ndr_history_id" string="NDR ID" />
                            <field name="ndr_raised_at" />
                            <field name="ndr_attempt" />
                            <field name="ndr_reason" />
                            <field name="comment" />
                        </tree>
                    </field>
                    <button string="Action NDR" name="action_ndr" type="object" class="oe_highlight"/>
                </page>
            </xpath>
            <xpath expr="//div[hasclass('oe_title')]" position="before">
                <widget name="web_ribbon" text="Unable To Place Order In Shiprocket"
                        bg_color="bg-danger"
                        attrs="{'invisible': ['|','|',('shiprocket_order_id', '!=', False),('state','not in',('done')),('delivery_type', '!=', 'shiprocket')]}"
                        tooltip="Unable to place order in shiprocket.please try once by clicking send to shipper button"/>
                <widget name="web_ribbon" title="Order Placed"
                    bg_color="bg-info"
                    attrs="{'invisible': ['|','|',
                    ('shiprocket_order_status_id', '!=', 1),
                    ('state','not in',('done')),
                    ('delivery_type', '!=', 'shiprocket')
                    ]}"/>
                <widget name="web_ribbon" title="AWB Generated"
                    bg_color="bg-info"
                    attrs="{'invisible': [
                    ('is_awb_generated','=',False)
                    ]}"/>
                <widget name="web_ribbon" title="Pickup Requested"
                    bg_color="bg-info"
                    attrs="{'invisible': [
                    ('is_pickup_request_done','=',False)
                    ]}"/>
                <widget name="web_ribbon" title="Manifest Generated"
                    bg_color="bg-success"
                    attrs="{'invisible': [
                    ('is_manifest_generated','=',False)
                    ]}"/>
                <widget name="web_ribbon" title="Delivered"
                    bg_color="bg-success"
                    attrs="{'invisible': [
                    ('shiprocket_order_status_id','!=',7)
                    ]}"/>
                <widget name="web_ribbon" title="Shipped"
                    bg_color="bg-success"
                    attrs="{'invisible': [
                    ('shiprocket_order_status_id','!=',6)
                    ]}"/>
                <widget name="web_ribbon" title="Order Cancelled"
                    bg_color="bg-danger"
                    attrs="{'invisible': ['|','|',
                    ('shiprocket_order_status_id', 'not in', (5,18)),
                    ('state','not in',('done')),
                    ('delivery_type', '!=', 'shiprocket')
                    ]}"/>
                <field name="shiprocket_order_status_id" invisible="1"/>
                <field name="is_awb_generated" invisible="1"/>
                <field name="is_pickup_request_done" invisible="1"/>
                <field name="is_manifest_generated" invisible="1"/>
            </xpath>
            <xpath expr="//button[@name='%(stock.action_report_delivery)d']" position="attributes">
                <attribute name="attrs">{'invisible': [('state', '!=', 'draft')]}</attribute>               
            </xpath>
            <xpath expr="//button[@name='%(stock.act_stock_return_picking)d']" position="attributes">
                <attribute name="attrs">{'invisible': [('delivery_type','=', 'shiprocket'),('shiprocket_order_status_id', '!=', 7)]}</attribute>               
            </xpath>
            <xpath expr="//button[@name='action_toggle_is_locked']" position="attributes">
                <attribute name="groups">base.group_no_one</attribute>               
            </xpath>
            <xpath expr="//button[@name='action_toggle_is_locked'][2]" position="attributes">
                <attribute name="groups">base.group_no_one</attribute>               
            </xpath>
            <xpath expr="//button[@name='send_to_shipper']" position="attributes">
                <attribute name="attrs">{'invisible':['|','|','|','|',('shiprocket_order_id','!=',False),('delivery_type','in', ['fixed', 'base_on_rule']),('delivery_type','=',False),('state','not in',('done')),('picking_type_code', '=', 'incoming')]}</attribute>
            </xpath>
            <xpath expr="//button[@name='send_to_shipper']" position="after">
                <button name="shiprocket_check_serviceability" string="Check Serviceability" type="object" attrs="{'invisible':['|','|','|',('courier_id','!=',False),('shiprocket_order_id','=',False),('shiprocket_shipping_id','=',False),('shiprocket_awb_code','!=',False)]}" />
                <button name="shiprocket_create_awb" confirm="Before Creating AWB Request Set Courier ID or It will be selected automatically based on your courier priority." string="Generate AWB" type="object" attrs="{'invisible':['|','|','|',('recommended_courier_company_id','=',False),('shiprocket_order_id','=',False),('shiprocket_shipping_id','=',False),('shiprocket_awb_code','!=',False)]}" />
                <button name="shiprocket_reassign_courier" string="Re-assign Courier" confirm="This Will Reassign Your Selected Courier.Do You Want To Proceed?" type="object" attrs="{'invisible':['|',('manifest_url','!=',False),('shiprocket_awb_code','=',False)]}" />
                <button name="shiprocket_generate_pickup_request" string="Generate Pickup Request" type="object" attrs="{'invisible':['|','|',('is_pickup_request_done','=',True),('shiprocket_awb_code','=',False),('label_url','=',False)]}" />
                <button name="shiprocket_generate_manifest_request" string="Generate Manifest" type="object" attrs="{'invisible':['|','|',('manifest_url','!=',False),('pickup_request_note','=',False),('manifest_url','!=',False)]}" />
                <button name="shiprocket_generate_label_request" string="Generate Label" type="object" attrs="{'invisible':['|','|','|','|',('shiprocket_awb_code','=',False),('delivery_type','in', ['fixed', 'base_on_rule']),('delivery_type','=',False),('state','not in',('done')),('delivery_type', '!=', 'shiprocket')]}" />
                <button name="get_shiprocket_status" string="Get Status" type="object" attrs="{'invisible':[('is_manifest_generated','=',False)]}" />
                <button name="shiprocket_print_manifest_request" string="Generate Manifest" type="object" attrs="{'invisible':[('manifest_url','=',False)]}" />
                <button string="Get NDR Details" name="get_ndr_details" type="object" class="oe_highlight" attrs="{'invisible':[('is_ndr','=',False)]}" context="{'specific_ndr':True}"/>
            </xpath>
        </field>
    </record>
    <!-- Transfer Tree View -->
    <record id="vpicktree_view_tree_inherit" model="ir.ui.view">
        <field name="name">stock.picking.delivery.tree.inherit.delivery</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='backorder_id']" position="after">
                <field name="pickup_location" optional="show"/>
                <field name="channel_id" optional="show" />
                <field name="shiprocket_order_id" string="Order ID" optional="show"/>
                <field name="shiprocket_shipping_id" string="Shipping ID" optional="show" />
                <field name="shiprocket_awb_code" string="AWB" optional="show"/>
                <field name="courier_id" optional="show"/>
                <field name="courier_rate" optional="show"/>
                <field name="shiprocket_order_status_id" optional="show" />
            </xpath>
        </field>
    </record>

    <record id="view_picking_internal_search_inherit" model="ir.ui.view">
        <field name="name">stock.picking.search.inherit.delivery</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='picking_type_id']" position="after">
                <field name="shiprocket_order_id" string="Order ID"/>
                <field name="shiprocket_shipping_id" string="Shipping ID" />
                <field name="shiprocket_awb_code" string="AWB"/>
                <field name="pickup_location"/>
            </xpath>
            <xpath expr="//filter[@name='backorder']" position="before">
                <filter name="carrier_id" string="Shiprocket" domain="[('carrier_id.delivery_type', '=', 'shiprocket')]"/>
            </xpath>
            <xpath expr="//filter[@name='picking_type']" position="after">
                <filter string="pickup Location" name="pickup_location" domain="[]" context="{'group_by': 'pickup_location'}" />
                <filter string="Channel" name="channel_id" domain="[]" context="{'group_by': 'channel_id'}" />
                <filter string="Courier" name="courier_id" domain="[]" context="{'group_by': 'courier_id'}" />
                <filter string="Shiprocket Status" name="shiprocket_order_status_id" domain="[]" context="{'group_by': 'shiprocket_order_status_id'}" />
            </xpath>
        </field>
    </record>

    <record id="action_picking_send_to_shipper" model="ir.actions.server">
        <field name="name">Send To Shipper</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="groups_id" eval="[(4, ref('stock.group_stock_manager'))]"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
        if records:
            for rec in records:
                rec.send_to_shipper()
        </field>
    </record>
    <record id="action_shiprocket_update_awb" model="ir.actions.server">
        <field name="name">Update Details From Shiprocket</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="groups_id" eval="[(4, ref('base.group_no_one'))]"/>
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
action = model.update_shiprocket_details_in_transfer()
        </field>
    </record>
    <record id="action_shiprocket_cancel_order" model="ir.actions.server">
        <field name="name">Cancel Order In Shiprocket</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="groups_id" eval="[(4, ref('stock.group_stock_manager'))]"/>
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
action = model.action_get_cancel_reason()
        </field>
    </record>

    <record id="bulk_processing_vpicktree" model="ir.ui.view">
        <field name="name">stock.picking.tree</field>
        <field name="model">stock.picking</field>
        <field name="arch" type="xml">
            <tree string="Picking list" multi_edit="1">
                <field name="priority" optional="show" widget="priority" nolabel="1"/>
                <field name="name" decoration-bf="1"/>
                <field name="origin" optional="show"/>
                <field name="picking_type_id" optional="show"/>
                <field name="partner_id" optional="show"/>
                <field name="pickup_location" optional="show"/>
                <field name="channel_id" optional="show" />
                <field name="shiprocket_order_id" string="Order ID" optional="hide"/>
                <field name="shiprocket_shipping_id" string="Shipping ID" optional="hide" />
                <field name="shiprocket_awb_code" string="AWB" optional="show"/>
                <field name="courier_id" optional="show"/>
                <field name="courier_rate" optional="hide"/>
                <field name="shiprocket_order_status_id" optional="show" />
                <field name="signature" string="Signed" optional="hide" groups="stock.group_stock_sign_delivery"/>
                <field name="user_id" optional="hshowide" widget="many2one_avatar_user"/>
                <field name="scheduled_date" optional="hide" widget="remaining_days" attrs="{'invisible':[('state', 'in', ('done', 'cancel'))]}"/>
                <field name="date_deadline" optional="hide" widget="remaining_days" attrs="{'invisible':[('state', 'in', ('done', 'cancel'))]}"/>
                <field name="group_id" invisible="1"/>
                <field name="backorder_id" optional="hide"/>
                <field name="company_id" groups="base.group_multi_company" optional="show"/>
                <field name="location_id" options="{'no_create': True}" string="From" groups="stock.group_stock_multi_locations" optional="hide"/>
                <field name="location_dest_id" options="{'no_create': True}" string="To" groups="stock.group_stock_multi_locations" optional="hide"/>
                <field name="state" optional="show" widget="badge" decoration-success="state == 'done'" decoration-info="state not in ('done', 'cancel')"/>
                <field name="activity_exception_decoration" widget="activity_exception"/>
                <field name="json_popover" nolabel="1" widget="stock_rescheduling_popover" attrs="{'invisible': [('json_popover', '=', False)]}"/>
            </tree>
        </field>
    </record>
    <record id="do_view_bulk_processing" model="ir.actions.act_window">
        <field name="name">Processed Orders</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">form,tree</field>
        <field name="view_id" ref="delivery_shiprocket.bulk_processing_vpicktree"/>
    </record>

    <record id="action_update_pickup_location" model="ir.actions.server">
        <field name="name">Update Pickup Location In Shiprocket</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="groups_id" eval="[(4, ref('stock.group_stock_manager'))]"/>
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
action = model.action_update_pickup_location()
        </field>
    </record>
</odoo>