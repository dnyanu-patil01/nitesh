<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<record id="view_seller_product_change_request_form" model="ir.ui.view">
		<field name="name">product.change.request.view.form</field>
		<field name="model">product.change.request</field>
		<field name="arch" type="xml">
			<form string="Seller Products" create="0" duplicate="0" delete="0">
				<header>
					<button name="button_approve" string="Approve" type="object" class="btn-success" groups="seller_product_management.group_product_approval"/>
					<button name="button_reject" string="Reject" type="object" class="btn-danger" groups="seller_product_management.group_product_approval"/>
				</header>
				<sheet>
					<div class="oe_title">
						<label class="oe_edit_only" for="name" string="Product Name"/>
						<h1>
							<field name="name" placeholder="Product Name"/>
						</h1>
					</div>
					<notebook>
						<page name="change_req_info" string="Change Request Note" groups="seller_product_management.group_product_approval">
							<field name="change_request_note" readonly="1" />
						</page>
						<page string="General Information" name="general_information">
							<group>
								<group name="group_general">
									<field name="l10n_in_hsn_code"/>
									<field name="l10n_in_hsn_description"/>
								</group>
								<group name="group_standard_price">
									<!-- <label for="list_price" />
									<div name="pricing">
										<field name="list_price" class="oe_inline" widget="monetary" options="{'field_digits': True}" />
									</div> -->
									<field name="taxes_id" widget="many2many_tags" options="{'no_create': True,'no_open':True}"/>
								</group>
							</group>
							<group string="Sales Description" name="description">
								<field name="description_sale" nolabel="1" placeholder="This note is added to shopify product description"/>
							</group>
							<group string="Internal Notes">
								<field name="description" nolabel="1" placeholder="This note is only for internal purposes."/>
							</group>
							<group string="Rejection Reason">
								<field name="rejection_reason" nolabel="1" readonly="1"/>
							</group>
						</page>
						<page string="Variants">
							<field name="variant_change_request_line">
								<tree editable="bottom" create="0" delete="0">
									<field name="attribute_id" readonly="1"/>
									<field name="value_ids" widget="many2many_tags" readonly="1"/>
									<field name="new_value_ids" widget="many2many_tags" options="{'no_create_edit': True}" context="{'default_attribute_id': attribute_id, 'show_attribute': False}" />
								</tree>
								<form>
									<group>
										<field name="attribute_id" readonly="1"/>
										<field name="value_ids" widget="many2many_tags" readonly="1"/>
										<field name="new_value_ids" widget="many2many_tags" options="{'no_create_edit': True}" context="{'default_attribute_id': attribute_id, 'show_attribute': False}"/>
									</group>
								</form>
							</field>
						</page>
					</notebook>
				</sheet>
			</form>
		</field>
	</record>

	<record id="view_product_change_request_tree" model="ir.ui.view">
		<field name="name">product.change.request.tree</field>
		<field name="model">product.change.request</field>
		<field name="arch" type="xml">
			<tree>
				<field name="name"/>
				<field name="change_request_note"/>
			</tree>
		</field>
	</record>
	<record id="action_approve_change_request" model="ir.actions.server">
		<field name="name">Approve</field>
		<field name="model_id" ref="seller_product_management.model_product_change_request"/>
		<field name="binding_model_id" ref="seller_product_management.model_product_change_request"/>
		<field name="binding_view_types">list</field>
		<field name="state">code</field>
		<field name="code">
		if records:
			for rec in records:
				if rec.product_tmpl_id:
					rec.write_change_product_template()
					rec.approve_variant_change()
					rec.product_tmpl_id.with_context({'active_ids':rec.product_tmpl_id.ids}).button_approve()
					rec.product_tmpl_id.write({"state": "approve"})
					rec.write({"state": "approve", "active": False})
		</field>
	</record>
	<record id="view_product_template_form_inherit" model="ir.ui.view">
		<field name="name">product.template.view.form.inherit</field>
		<field name="model">product.template</field>
		<field name="inherit_id" ref="product.product_template_only_form_view"/>
		<field name="arch" type="xml">
			<xpath expr="//form/header" position="inside">
				<button name="change_request" string="Change Request" states="approve,reject" type="object"  groups="seller_management.group_sellers_management_user"/>
				<button name="button_submit" string="Submit For Approval"  confirm="Changes Will Be Update In Portal After Fulfilment Team Approval" states="draft" type="object"  groups="seller_management.group_sellers_management_user"/>
				<button name="button_approve" string="Approve" states="to_approve" type="object" class="btn-success" groups="seller_product_management.group_product_approval"/>
				<button name="button_reject" string="Reject" states="to_approve" type="object" class="btn-danger" groups="seller_product_management.group_product_approval"/>
				<field name="state" widget="statusbar" statusbar_visible="draft,to_approve,approve,reject"/>
			</xpath>
		</field>
	</record>
	<record id="view_product_form_inherit" model="ir.ui.view">
		<field name="name">product.product.view.form.inherit</field>
		<field name="model">product.product</field>
		<field name="inherit_id" ref="product.product_normal_form_view"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='type']" position="before">
				<field name="state" readonly="1"/>
			</xpath>
			<xpath expr="//field[@name='uom_po_id']" position="after">
				<field name="compare_at_price" readonly="1"/>
			</xpath>
		</field>
	</record>
	<record id="view_product_varients_form_inherit" model="ir.ui.view">
		<field name="name">product.product.view.form.inherit</field>
		<field name="model">product.product</field>
		<field name="inherit_id" ref="product.product_variant_easy_edit_view"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='type']" position="before">
				<field name="state" readonly="1"/>
			</xpath>
		</field>
	</record>
	<record model="ir.ui.view" id="product_search_tree_view_inherit">
		<field name="name">product.template.search.inherit</field>
		<field name="model">product.template</field>
		<field name="inherit_id" ref="product.product_template_search_view"/>
		<field name="arch" type="xml">
			<filter name="filter_to_sell" position="before">
				<filter name="filter_draft" string="Draft" domain="[('state', '=', 'draft')]"/>
				<filter name="filter_approve" string="Approved" domain="[('state', '=', 'approve')]"/>
				<filter name="filter_reject" string="Rejected" domain="[('state', '=', 'reject')]"/>
				<filter string="Status" name="status" context="{'group_by':'state'}"/></filter>
		</field>
	</record>
	<record id="view_seller_sale_product_template_tree" model="ir.ui.view">
		<field name="name">product.template.seller.tree.inherit</field>
		<field name="model">product.template</field>
		<field name="inherit_id" ref="product.product_template_tree_view"/>
		<field name="arch" type="xml">
			<field name="uom_id" position="after">
				<field name="state"/></field>
		</field>
	</record>
	<record id="view_sellers_product_template_tree_inherit" model="ir.ui.view">
		<field name="name">product.template.view.form.inherit</field>
		<field name="model">product.template</field>
		<field name="inherit_id" ref="seller_management.view_sellers_product_template_tree"/>
		<field name="arch" type="xml">
			<xpath expr="//tree" position="attributes">
				<attribute name="decoration-info">state == 'draft'</attribute>
				<attribute name="decoration-muted">state == 'reject'</attribute>
				<attribute name="decoration-warning">state == 'to_approve'</attribute>
				<attribute name="decoration-success">state == 'approve'</attribute>
			</xpath>
			<xpath expr="//field[@name='uom_id']" position="after">
				<field name="state" />
			</xpath>
		</field>
	</record>
	<record id="view_product_template_form_inherit" model="ir.ui.view">
		<field name="name">product.template.view.form.inherit</field>
		<field name="model">product.template</field>
		<field name="inherit_id" ref="seller_management.view_seller_product_template_form"/>
		<field name="arch" type="xml">
            <xpath expr="//sheet" position="before">
                <div class="alert alert-info" role="alert" style="margin-bottom:0px;">
                    <b> Please Contact Fulfilment Team For Managing Images And Adding New Variants </b>
                </div>
            </xpath>
			<xpath expr="//button[@name='seller_update_stock_quantity']" position="before">
				<button name="change_request" string="Change Request" states="draft,to_approve,approve,reject" type="object"  groups="seller_management.group_sellers_management_user"/>
				<button name="button_submit" string="Submit For Approval"  confirm="Changes Will Be Update In Portal After Fulfilment Team Approval" states="draft" type="object"  groups="seller_management.group_sellers_management_user"/>
				<!--<button name="button_approve" string="Approve" states="to_approve" type="object" class="btn-success" groups="seller_product_management.group_product_approval"/>
				<button name="button_reject" string="Reject" states="to_approve" type="object" class="btn-danger" groups="seller_product_management.group_product_approval"/> -->
				<field name="state" widget="statusbar" statusbar_visible="draft,to_approve,approve,reject"/>
			</xpath>
			<xpath expr="//div[hasclass('oe_button_box')]" position="after">
				<widget name="web_ribbon" title="Draft"
                    bg_color="bg-info"
                    attrs="{'invisible': [
                    ('state','!=','draft')
                    ]}"/>
				<widget name="web_ribbon" title="Approved"
                    bg_color="bg-success"
                    attrs="{'invisible': [
                    ('state','!=','approve')
                    ]}"/>
				<widget name="web_ribbon" title="Rejected"
                    bg_color="bg-danger"
                    attrs="{'invisible': [
                    ('state','!=','reject')
                    ]}"/>
				<widget name="web_ribbon" title="Waiting For Approval"
                    bg_color="bg-dark"
                    attrs="{'invisible': [
                    ('state','!=','to_approve')
                    ]}"/>
			</xpath>
			<xpath expr="//group[@name='internal_notes']" position="after">
				<group string="Rejection Reason" attrs="{'invisible':[('state','!=','reject')]}">
					<field name="rejection_reason" nolabel="1" readonly="1"/>
				</group>
			</xpath>
		</field>
	</record>
	<record id="view_order_form" model="ir.ui.view">
		<field name="name">sale.order.form.inherit</field>
		<field name="model">sale.order</field>
		<field name="type">form</field>
		<field name="inherit_id" ref="sale.view_order_form"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="attributes">
				<attribute name="options">{'no_create': true}</attribute>
				<attribute name="domain">[('state', '=', 'approve')]</attribute>
			</xpath>
		</field>
	</record>
	<record model="ir.ui.view" id="account_move_form_view_inherit">
		<field name="name">customer.move.form.inherit</field>
		<field name="model">account.move</field>
		<field name="inherit_id" ref="account.view_move_form"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='product_id']" position="attributes">
				<attribute name="options">{'no_create': true}</attribute>
				<attribute name="domain">[('state', '=', 'approve')]</attribute>
			</xpath>
		</field>
	</record>
	<record model="ir.ui.view" id="stock_picking_form_view_inherit">
		<field name="name">stock.picking.form.inherit</field>
		<field name="model">stock.picking</field>
		<field name="inherit_id" ref="stock.view_picking_form"/>
		<field name="arch" type="xml">
			<xpath expr="//field[@name='move_ids_without_package']/tree//field[@name='product_id']" position="attributes">
				<attribute name="domain">[('state', '=', 'approve')]</attribute>
			</xpath>
		</field>
	</record>
</odoo>
